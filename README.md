## Запуск приложения

### Development

Для запуска приложения в среде разработки доступны варианты запуска напрямую через `python` и
через `docker-compose`. Оба варианта используют для конфигурации переменные окружения, которые
описаны в файле `app/core/config.py`. В данных режимах запуска доступно обновление кода приложения
на лету, без перезапуска (кроме случаев добавления новых зависимостей).

#### Python Runner

```bash
python -m app
```

#### Docker runner

```bash
docker-compose up -d
```

### Production docker

```bash
docker-compose -f docker-compose.prod.yml up -d
```

## Разработка

Команда для создания или апдейта базы:

```bash
docker-compose exec app flask db upgrade
```

Команда для создания новой миграции:

```bash
docker-compose exec app flask db migrate -m "<migrate_name>"
```

Команда для создания суперюзера:

```bash
docker-compose exec app flask create_superuser -u <"username"> -p <"Password">
```

Регистрация проверяет пароль на валидность (минимум 8 символов, одна большая, одна маленькая буква,
одна цифра и один спец знак) {"login":"test","password":"Test1990!"}

При логине в сессию записывается user_agent устройства. Ключ рефреш токена создаются из айди и
юзер_агента пользователя в ответе получаете access_token и refresh_token (они Bearer)

для рефреша токена нужно в теле отправить рефреш токен ({"refresh_token":"<refresh_token>"})

Логаут записывает access токен в редис для невалидности след запросов с ним а также удаляет рефреш
токен из редиса чтобы с ним нельзя было запросить новый access_token

### Перед началом работы

```bash
make dev
```

Это позволит проверить внесённые изменения до их сохранения.

### Зависимости

Управлением зависимостями занимается утилита `poetry`. \
Перечень зависимостей находится в файле `pyproject.toml`. \
Инструкция по настройке poetry-окружения для
pyCharm [здесь](https://www.jetbrains.com/help/pycharm/poetry.html).

Для добавления зависимости достаточно написать `poetry add requests`, утилита сама подберёт версию,
не конфликтующую с текущими зависимостями. \
Зависимости с точными версиями фиксируются в файл `poetry.lock`. \
Для получения дерева зависимостей можно воспользоваться командой `poetry show --tree`. Остальные
команды доступны в официальной документации к утилите.

### Тестирование

Тесты оформлены в виде полностью независимого решения, в котором не используется код основной
программы. Для запуска тестирования достаточно вызвать в корне проекта команду

```bash
make test
```
